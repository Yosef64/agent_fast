
from nanoid import generate
from .db import db
from datetime import datetime
userInfo_ref = db.collection("Agents").document("agentInfo")
userStat_ref = db.collection("Agents").document("agentStat")
payment_ref = db.collection("paymentReq")
session_ref = db.collection("session")
def getUserInfo():
    users = userInfo_ref.get().to_dict()
    return users
def getUserStat():
    users = userStat_ref.get().to_dict()
    return users
def getUserStatById(userId):
    userRef = getUserById(userId)
    users = getUserStat()
    return [users[userRef],userRef] if userRef else [False,userRef]
def updateUserStat(referal):
    users = getUserStat()
    curUser = users[referal]["ownStud"] + 1
    userInfo_ref.update({referal:curUser})
    curParent , ind = users[referal]["parent"] , 0
    while ind < 2 and curParent:
        curUser = users[curParent]["agentStud"] + 1
        userInfo_ref.update({curParent:curUser})
        curParent , ind = users[curParent]["parent"] , ind + 1
def registerAgent(userInfo,referal):
    agentStat = {"ownStud":0,"agentStud":0,"parent":str(referal),"timestamp":[],"totalAmount":0}
    userReferal = generate(size=10)
    userInfo_ref.update({userReferal:userInfo})
    userStat_ref.update({userReferal:agentStat})
def getUserById(userId):
    users = userInfo_ref.get().to_dict()
    for ref in users:
        if users[ref]["teleid"] == userId:
            return ref
    return ""
def askPayment(userId):
    ref = getUserById(userId)
    currentDate = datetime.utcnow().strftime('%Y-%m-%dT%H:%M:%SZ')
    if ref:
        doc_ref = payment_ref.document(ref).get()
        if doc_ref.exists:
            return [True,False,False]
        else:
            allStat , allInfo = getUserStat(),getUserInfo()
            stat , _ =  getUserStatById(userId)
            curAmount = stat["totalAmount"]
            if curAmount < 100:
                return [True,False,True]
            newInfo = {**allInfo[ref],**allStat[ref],"date":currentDate,"id":ref,"curAmount":curAmount}
            payment_ref.document(ref).set(newInfo)
            return [True,True,False]
    return [False,False,False]

def getOwnAgent(ref):
    agentsStat = userStat_ref.get().to_dict()
    count = 0
    for refs in agentsStat:
        if agentsStat[refs]["parent"] == ref:
            count += 1
            
    return count

def addSession(tele_id,referal):
    ref = session_ref.document(tele_id)
    if ref.get().exists:
        return
    ref.set({"referal":referal})
    
def getSession(tele_id):
    ref = session_ref.document(tele_id).get()
    if ref.exists:
        return ref.get()["referal"]
    return ""
    
    
intro_text = """ðŸŽ‰Well Come to Victory Agent system

Victory official channelðŸ‘‡
https://t.me/VictoryTutor_7

áŠ¨á‰°áˆ›áˆªá‹Žá‰»á‰½áŠ• á‹¨á‰°áˆ°áŒ¡ áŠ áˆµá‰°á‹«á‹¨á‰¶á‰½ðŸ‘‡
https://t.me/victorystcom_7

á‹¨victory team áˆˆáˆ›áŠ“áŒˆáˆ­ðŸ‘‡
@VICTORY_TUTOR_TEAMS

á‹¨á‰µáˆáˆ…áˆ­á‰±áŠ• áŠ áˆ°áŒ£á‰µ Sample áˆˆáˆ›á‹¨á‰µðŸ‘‡
https://t.me/VictorySample7


ðŸŒŸá‹¨áŠ¤áŒ€áŠ•á‰µ áˆ²áˆµá‰°áˆ áŠ áˆ°áˆ«áˆ­ áŠ¥áŠ“ á‹¨áŠ áŠ¨á‹áˆáˆ áˆáŠ”á‰³
âœ¨áŠ áŠ•á‹µ á‹¨á‰ªáŠ­á‰µáˆª áŠ¤áŒ€áŠ•á‰µ á‰ áˆ˜áˆ†áŠ• áˆ˜áˆµáˆ«á‰µ á‹¨áˆšáˆáˆáŒ áˆ°á‹ á‰ áˆ˜áŒ€áˆ˜áˆ­á‹« áˆµáˆˆ á‰ªáŠ­á‰µáˆª áŠ¥áŠ“ áˆµáˆˆáˆšáˆ°áŒ£á‰¸á‹ áŠ áŒˆáˆáŒáˆŽá‰¶á‰½ áŒ áŠ•á‰…á‰† áˆ›á‹ˆá‰… á‹­áŠ–áˆ­á‰ á‰³áˆá¢

âœ¨á‰ áˆ˜áˆ†áŠ‘áˆ áˆˆá‰°áˆ›áˆªá‹Žá‰»á‰½áŠ• áˆµáˆˆáˆáŠ•áˆ°áŒ á‹ áŠ áŒˆáˆáŒáˆŽá‰µ á‹¨á‰°á‰€áˆ˜áŒ á‹áŠ• áŠ áŒ­áˆ­ á‹¶áŠ­áˆ˜áŠ•á‰µ áŠ áŠ•á‰¥á‰¦ áˆ˜áˆ¨á‹³á‰µ á‹­áŠ–áˆ­á‰¥áˆ­á‰³áˆá¢

âœ¨áŠ áŠ•á‹µ áˆ°á‹ áŠ¤áŒ€áŠ•á‰µ áˆ†áŠ– áŠ¨áˆ˜áˆ˜á‹áŒˆá‰¡ á‰ áŠá‰µ áˆµáˆ«á‹áŠ• áˆˆáˆ˜áˆµáˆ«á‰µ á‹¨áˆšá‹«áˆµá‰½áˆ á‰¥á‰ƒá‰µ á‹ˆá‹­áˆ ááˆ‹áŒŽá‰µ áŠ¥áŠ“ á‰¥á‹›á‰µ á‰°áˆ›áˆªá‹Žá‰½áŠ• áˆ›áŒáŠ˜á‰µ áŠ¥áŠ•á‹°áˆšá‰½áˆ áŠ¥áˆ«áˆ±áŠ• áˆ˜áˆˆá‹¨á‰µ á‹­áŠ–áˆ­á‰ á‰³áˆá¢

âœ¨á‹­áˆ…áŠ•áŠ• áˆµáˆ« á‰ á‰°áˆ»áˆˆ áˆáŠ”á‰³ áˆˆáˆ˜áˆµáˆ«á‰µ á‰°áˆ›áˆªá£ áˆ˜áˆáˆ…áˆ­ á‰ á‰°áˆˆá‹«á‹© áˆ›áˆ…á‰ áˆ«á‹Š áŒˆá†á‰½ áˆ‹á‹­ áŠ¥áŠ•á‰…áˆµá‰ƒáˆ´á‹Žá‰½ á‹¨áˆšá‹«á‹°áˆ­áŒ áˆ²áˆ†áŠ áŠ áˆá‹«áˆ potential market-áŠ¡áŠ• á‹¨áˆšá‹«áŒˆáŠ áˆŠáˆ†áŠ• á‹­áŒˆá‰£áˆá¢


  ðŸŒŸá‹¨áŠ áˆ°áˆ«áˆ­ á‰…á‹°áˆ á‰°áŠ¨á‰°áˆŽá‰½
1ï¸âƒ£áŠ áŠ•á‹µ áˆ°á‹ á‹¨á‰µáˆáˆ…áˆ­á‰µ áŠ áˆ°áŒ£áŒ¡áŠ• á‹¶áŠ­áˆ˜áŠ•á‰µ á‰ á‹°áŠ•á‰¥ áŠ«áŠá‰ á‰  á‰ áŠ‹áˆ‹ bot-áŠ¡áŠ• á‰ áˆ˜áŒ á‰€áˆ áˆµáˆ™áŠ• áŠ¥áŠ“ áŠ áŠ«á‹áŠ•á‰±áŠ• áŒ¨áˆáˆ® áˆ™áˆ‰ á‹¨áˆšáŒ á‹¨á‰€á‹áŠ• áˆ˜áˆ¨áŒƒá‹Žá‰½ á‹«áˆµáˆ˜á‹˜áŒá‰£áˆá¢

âœ¨á‹­áˆ… áˆ™áˆ‰ áˆ˜áˆ¨áŒƒ á‹ˆá‹° áˆ˜áˆ¨áŒƒ á‰‹á‰³á‰½áŠ• (database) á‰ áˆ˜áˆ„á‹µ á‹­á‰€áˆ˜áŒ£áˆá¢ á‰ áˆ˜á‰€áŒ áˆáˆ á‹¨á‰°áˆ˜á‹˜áŒˆá‰ á‹áŠ• áŠ¤áŒ€áŠ•á‰µ áˆáŠ• á‹«áŠ­áˆ á‰°áˆ›áˆª áŠ¥áŠ•á‹³áˆµáˆ˜á‹˜áŒˆá‰  á£ á‰ áˆµáˆ© áˆáŠ• á‹«áˆ…áˆ áŠ¤áŒ€áŠ•á‰µ áŠ¥áŠ•á‹³áˆˆá£ áˆáŠ• á‹«áˆ…áˆ á‰¥áˆ­ áŠ¥áŠ•á‹³áˆˆá‹ áŠ¥áŠ“ áˆáŠ• á‹«áŠ­áˆ áŠ¥áŠ•á‹³á‹ˆáŒ£ áŠ¥á‹«áŠ•á‹³áŠ•á‹±áŠ• áŠáŒˆáˆ­ á‰ áˆ°áˆ«áŠá‹ áˆ²áˆµá‰°áˆ áˆ™áˆ‰ á‹¨áˆáŠ•á‰†áŒ£áŒ áˆ¨á‹ (track) á‹¨áˆáŠ“á‹°áˆ­áŒˆá‹ á‹­áˆ†áŠ“áˆá¢

2ï¸âƒ£ á‹­áˆ…áŠ•áŠ• áˆ‚á‹°á‰µ áŠ«áŒ áŠ“á‰€á‰€ á‰ áŠ‹áˆ‹ â€œá‹¨ Referal link áˆˆáˆ›áŒáŠ˜á‰µ â€ á‹¨áˆšáˆˆá‹áŠ• á‰ áˆ˜áŠ•áŠ«á‰µ á‹¨áˆ«áˆ±áŠ• link á‹­áˆ°áŒ á‹‹áˆá¢ á‹­áˆ…áŠ•áŠ• link á‰ áˆ˜á‹«á‹ á‰°áˆ›áˆªá‹Žá‰½áŠ• áŠ¥á‹«áŠ“áŒˆáˆ¨ á‰ áˆ± áˆŠáŠ•áŠ­ á‰°áˆ›áˆªá‹Žá‰½ áŠ¥áŠ•á‹²áŒˆá‰¡ á‹«á‹°áˆ­áŒ‹áˆá¤ á‰  social media á‹¨áˆšáˆ°áˆ«áˆ áŠ¨áˆ†áŠ á‹°áŒáˆž áˆ›áˆµá‰³á‹ˆá‰…á‹«á‹Žá‰½áŠ• áŠ¥á‹¨áˆ°áˆ« link-áŠ¡áŠ• á‰ áˆ›áˆµá‰€áˆ˜áŒ¥ á‰°áˆ›áˆªá‹Žá‰½ áŠ¥áŠ•á‹²áˆ˜á‹˜áŒˆá‰¡ á‹«á‹°áˆ­áŒ‹áˆá¢

âœ¨á‹­áˆ„ linkÂ  á‹¨áˆšáˆ˜á‹˜áŒˆá‰¡ á‰°áˆ›áˆªá‹Žá‰½áŠ• á‹ˆá‹° á‰°áˆ›áˆªá‹Žá‰½ áˆ˜áˆ˜á‹áŒˆá‰¥á‹« Bot á‹¨áˆšá‹ˆáˆµá‹³á‰¸á‹ áˆ²áˆ†áŠ• á‰°áˆ›áˆªá‹Žá‰¹ áˆáŠ­ á‰°áˆ˜á‹áŒá‰ á‹ Approval áŠ¥áŠ•á‹³áŒˆáŠ™ áˆˆáŠ¤áŒ€áŠ•á‰± áˆ²áˆµá‰°áˆ™ áˆ«áˆ± á‰ áˆ± link á‹¨á‰°áˆ˜á‹˜áŒˆá‰ á‹áŠ• á‰°áˆ›áˆª screensoot áŠ¥áŠ“ Approval á‹¨áˆšáˆáŠ­áˆˆá‰µ áˆ²áˆ†áŠ• á‹¨á‰°áˆ˜á‹˜áŒˆá‰ á‹ á‰°áˆ›áˆª áˆµáŠ•á‰°áŠ›á‹ áŠ¥áŠ•á‹°áˆ†áŠ á‹­áŒˆáˆá…áˆˆá‰³áˆá¢

âœ¨á‰¥áˆ­ áˆˆáˆ›á‹áŒ£á‰µ áˆ²áˆáˆáŒ â€œá‰¥áˆ­ áˆˆáˆ›á‹áŒ£á‰µâ€ á‹¨áˆšáˆˆá‹áŠ• á‰ áˆ˜áŠ•áŠ«á‰µ á‹­áŒ á‹­á‰ƒáˆá¢áŠ¥áŠ›áˆ á‹«áˆµáˆ˜á‹˜áŒˆá‰ á‹áŠ• á‰°áˆ›áˆª á‰¥á‹›á‰µ á‰ áˆ˜á‰¶ á‰ áˆ›á‰£á‹›á‰µ á‰£áˆµáˆ˜á‹˜áŒˆá‰ á‹ á‰£áŠ•áŠ­ áŠ áŠ«á‹áŠ•á‰µ á‹¨áˆáŠ•áˆáŠ­áˆˆá‰µ á‹­áˆ†áŠ“áˆá¢

3ï¸âƒ£áŠ áŠ•á‹µ áŠ¤áŒ€áŠ•á‰µ á‰ áˆµáˆ© 2 á‰°áˆ›áˆª áŠ«áˆµáŒˆá‰£ á‰ áŠ‹áˆ‹ á‹¨áŠ¤áŒ€áŠ•á‰µ Referral link á‹¨áˆšáˆˆá‹áŠ• á‰ áˆ˜áŠ•áŠ«á‰µ á‹¨áŠ¤áŒ€áŠ•á‰µ refrral link áˆ›áŒáŠ˜á‰µ á‹­á‰½áˆ‹áˆá¢ á‹¨á‹šáˆ… á‹‹áŠáŠ›á‹ áˆµáˆ« á‹‹áŠ“á‹ áŠ¤áŒ€áŠ•á‰µ á‰ áˆµáˆ© áˆŒáˆŽá‰½ áŠ¤áŒ€áŠ•á‰¶á‰½áŠ• á‰ áˆ˜áˆ˜áˆáˆ˜áˆ áŠ¥áŠá‹› áŠ¤áŒ€áŠ•á‰¶á‰½ á‰°áˆ›áˆªá‹Žá‰½áŠ• áˆ²á‹«áˆµáŒˆá‰¡ á‹‹áŠ“á‹ áŠ¤áŒ€áŠ•á‰µ áŠ¨áŠ¥á‹«áŠ•á‹³áŠ•á‹± áŠ¤áŒ€áŠ•á‰µ á‰£áˆµáŒˆá‰¡á‰µ á‹¨á‰°áˆ›áˆª áˆáŠ­ á‰ 25 á‰¥áˆ­ á‰ áˆ›á‰£á‹›á‰µ á‹¨áˆšá‹«áŒˆáŠ áˆ²áˆ†áŠ• á¢

âœ¨á‰ áˆµáˆ© á‹«áˆ‰ áŠ¤áŒ€áŠ•á‰¶á‰½ áŒáŠ• áˆáŠ­ áŠ¥áŠ•á‹°á‰°áˆˆáˆ˜á‹°á‹ á‹¨ 100 á‰¥áˆ­ áŠ­áá‹« á‰£áˆµáŒˆá‰¡á‰µ á‰°áˆ›áˆª á‰°á‰£á‹á‰¶ áŠ­áá‹«á‹áŠ• á‹«áŒˆáŠ›áˆ‰á¢

âœ¨áŠ áŠ•á‹µ áŠ¤áŒ€áŠ•á‰µ á‹¨áŠ¤áŒ€áŠ•á‰µ link á‰¢á‹«á‹ˆáŒ£ á‰°áˆ˜áˆ«áŒ­ á‹¨áˆšáˆ†áŠá‹ á‰¥á‹™ á‰°áˆ›áˆªá‹Žá‰½áŠ• á‹¨áˆšá‹«áŒˆáŠá‰ á‰µ á‹¨áˆµáˆ« á‹˜áˆ­á á‹áˆµáŒ¥ áŠ«áˆˆ áŠ¥áŠ“ á‹¨á‰µ/á‰¤á‰µ á‰°áˆ›áˆªá‹Žá‰½ áŠ¨áˆ­áˆ± áŒ‹áˆ­ áŠ¤áŒ€áŠ•á‰µ áˆ†áŠá‹ áˆˆáˆ˜áˆµáˆ«á‰µ áá‰ƒá‹°áŠ› áŠ¨áˆ†áŠ‘ áŠá‹á¢

âœ¨á‰ áŠ¤áŒ€áŠ•á‰µ áˆµáˆ­ á‹¨áˆšáŒˆá‰£ áŠ¤áŒ€áŠ•á‰µ á‰¥á‹™ á‰°áˆ›áˆªá‹Žá‰½ áŠ¥áŠ•á‹²á‹«áˆµáŒˆá‰£ á‰ á‰°á‰»áˆˆ áˆ˜áŒ áŠ• á‹¨ 11 áŠ áˆá‹«áˆ á‹¨ 12áŠ› áŠ­ááˆ á‹¨ social á‹ˆá‹­áˆÂ  Natural á‰°áˆ›áˆª áˆ˜áˆ†áŠ• á‹­áŒ á‰ á‰…á‰ á‰³áˆá¢

âœ¨áŠ áŠ•á‹µ áŠ¤áŒ€áŠ•á‰µ áŠ¨áˆ± áˆµáˆ­ áŠ¤áŒ€áŠ•á‰µ áŠ¥áŠ•á‹²áˆ˜á‹˜áŒˆá‰¥ áˆ²áˆáˆáŒ áˆáˆˆá‰µ á‰°áˆ›áˆª á‰…á‹µáˆšá‹« áˆ›áˆµáˆ˜á‹áŒˆá‰¥ á‹­áŠ–áˆ­á‰ á‰³áˆá¢ á‰ áˆ˜á‰€áŒ áˆ link-áŠ¡áŠ• áŠ«áŒˆáŠ˜ á‰ áŠ‹áˆ‹ á‰ áˆµáˆ© áˆˆá‹›á‹ áŠ¤áŒ€áŠ•á‰µ áˆ²áˆáŠ­áˆˆá‰µ áŠ á‹²áˆ±áŠ• áŠ¤áŒ€áŠ•á‰µ á‰ á‰€áŒ¥á‰³ á‹ˆá‹° áˆ˜áˆ˜á‹áŒˆá‰¥á‹« Bot á‹¨áˆšá‹ˆáˆµá‹°á‹ á‹­áˆ†áŠ“áˆá¢

âœ¨áŠ á‹²áˆ± áŠ¤áŒ€áŠ•á‰µ áŠ¨á‰°áˆ˜á‹˜áŒˆá‰  á‰ áŠ‹áˆ‹ á‹¨áˆ«áˆ±áŠ• referral link á‰ áˆ˜á‹áˆ°á‹µ á‰°áˆ›áˆªá‹Žá‰½ áŠ¥áŠ•á‹²áˆ˜á‹˜áŒˆá‰¡ áˆ²á‹«á‹°áˆ­áŒ áˆˆáˆ«áˆ±áˆ áˆˆáˆ˜áŒ€áˆ˜áˆ­á‹«á‹áˆ áŠ¤áŒ€áŠ•á‰µ á‹¨áˆšá‰†áˆ­áŒ¥áˆˆá‰µ á‹­áˆ†áŠ“áˆá¢

áˆ›áˆ³áˆ°á‰¥á‹«á¦ áˆáˆˆá‰°áŠ›á‹ áŠ¤áŒ€áŠ•á‰µ á‰ áˆµáˆ© áˆ¶áˆµá‰°áŠ› áŠ¤áŒ€áŠ•á‰µ á‰¢á‹«áˆµáŒˆá‰£ áˆ¶áˆµá‰°áŠ›á‹ á‹¨áˆšá‹«áˆ˜áŒ£á‹ á‰°áˆ›áˆª áˆˆáˆ«áˆ± áŠ¥áŠ“ áˆˆáˆáˆˆá‰°áŠ›á‹ áŠ¤áŒ€áŠ•á‰µ á‰¥á‰» á‰¥áˆ­ á‹¨áˆšá‹«áŒˆáŠ á‹­áˆ†áŠ“áˆ á¢

âœ¨á‰ á‹šáŠ›á‹áˆ áˆ‚á‹°á‰µ á‹¨áˆ˜áŒ€áˆ˜áˆ­á‹«á‹ áŠ¤áŒ€áŠ•á‰µ áˆáŠ•áˆ á‰¥áˆ­ á‹¨áˆ›á‹­áŠ¨áˆáˆˆá‹ áˆ˜áˆ†áŠ‘áŠ• áˆˆáˆ˜áŒáˆˆá… áŠ¥áŠ•á‹ˆá‹³áˆˆáŠ•á¢

á‹¨áŠ¤áŒ€áŠ•á‰µ á‰¦á‰µ áˆˆáŠ¤áŒ€áŠ•á‰± áˆ›á‹¨á‰µ á‹¨áˆšáˆáˆáŒ‹á‰¸á‹áŠ• á‹áˆ­á‹áˆ®á‰½ á‹«á‰€áˆ á‰ áˆ˜áˆ†áŠ‘ á‰ á‹¨áŒŠá‹œá‹ áŠ¥á‹¨áŒˆá‰£ check áˆ›á‹µáˆ¨áŒ á‹­á‰½áˆ‹áˆá¢"""